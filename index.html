<html><head>
  <title>A sonnet</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href='http://fonts.googleapis.com/css?family=Lusitana:400,700|Just+Another+Hand|Reenie+Beanie|Open+Sans:400,700|La+Belle+Aurore|Mrs+Saint+Delafield'
        rel='stylesheet' type='text/css'>
  <style type="text/css">
    body {
         padding-top:     5em;
         padding-bottom:  5em;
         padding-left:    7em;
         font-family: 'Lusitana', Georgia, serif;
     }
     h1 {
         font-size: 2.2em;
     }
     .poem {
         width: 28em;
         padding-right:   3em;
         font-size: 110%;
     }
    .right {
         background: #cc9258;
         font-family: Verdana, sans-serif;
     }
     .sidebar {
         background: #7d2a35;
         font-size: 85%;
         color: #feffc2;
     }
     input { background: #feffc2; }
     a { color: #bfba6c; }
     a:link {text-decoration:none;}
     a:visited {text-decoration:none;}
     a:hover {text-decoration:underline;}
     a:active {text-decoration:underline;}

     .font1 { font-family: 'Lusitana', Georgia, serif; font-size: 110%; }

     .font2 { font-family: 'Just Another Hand', cursive; font-size: 175%; }
     #title.font2 { font-weight: normal; }

     .font3 { font-family: 'Reenie Beanie', cursive; font-size: 150%; }
     #title.font3 { font-weight: normal; }

     .font4 { font-family: 'Open Sans', sans-serif; font-size: 100%; }

     .font5 { font-family: 'La Belle Aurore', cursive; font-size: 125%; line-height: 160%; }
     #title.font5 { font-weight: normal; }

     .font6 { font-family: 'Mrs Saint Delafield', cursive; font-size: 150%; line-height: 125%; }
     #title.font6 { font-weight: normal; }

     .font7 { font-family: 'Courier New', 'Courier', fixed; font-size: 100%; }
  </style>
  <script type="text/javascript">
'use strict';

window.onload = function() {

function randomTitle() {
    Math.seedrandom(new Date().getTime());
    return 'Sonnet ' + numberWithCommas(pickInt(Math.pow(2, 45)));
}

// From http://stackoverflow.com/questions/2901102
function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

function pushTitle(text) {
    location.hash = 'title=' + text;
    setTitle(text);
}

window.onhashchange = function() {
    setTitle(getTitle());
};

function getTitle() {
    return location.hash.toString().substring(1).replace(/^title=/, '');
}

function setTitle(text) {
    title.replaceChild(document.createTextNode(dumbQuote(text)),
                       title.firstChild);
    Math.seedrandom(text);
    var fontClass = pickFont();
    verse.className = fontClass;
    title.className = fontClass;
    invokeTheMuse(text);
    permalink.href = location.href;
}

function pickFont() {
    var k = 2 + pickInt(12);
    if (7 < k) k = 1;
    return 'font' + k;
}

var stopVersifier = noOp, stopUpdater = noOp;
var verseCache = {};

function invokeTheMuse(title) {
    stopVersifier();
    stopUpdater();
    var cached = verseCache['title=' + title];
    if (cached) {
        verse.innerHTML = cached;
        return;
    }
    stopVersifier = versify(function(result) { 
        stopUpdater();
        verse.innerHTML = result;
        verseCache['title=' + title] = result;
    });
    function updateVerse() {
        verse.innerHTML = emit(states);
    }
    stopUpdater = repeatedly(updateVerse, 50);
}

var title         = document.getElementById('title');
var verse         = document.getElementById('verse');
var another       = document.getElementById('another');
var anothertitle  = document.getElementById('anothertitle');
var composetitled = document.getElementById('composetitled');
var permalink     = document.getElementById('permalink');

if (location.hash === '') {
    var url = document.URL + '#title=' + randomTitle();  // XXX need to encode anything?
    location.replace(url);
// XXX apparently it's not adding to the history? check this...
}

another.onclick = function() {
    pushTitle(randomTitle());
    return false;
};

composetitled.onclick = function() {
    pushTitle(anothertitle.value);
    anothertitle.value = '';
    return false;
};

setTitle(getTitle());

};
  </script>
</head>
<body>
  <h1><span id="title" class="font1">A sonnet</span></h1>
  <table>
    <tr>
      <td class="left">
        <div class="poem">
          <p id="verse" class="font1"><span style="font-size: smaller">[Excuse me a moment while I invoke the muse...]</div>
      </td>
      <td>
        <div class="right">
        <table cellpadding=12 cellspacing=12>
          <tr class="sidebar"><td>
            <a id="another" href="#">Make another sonnet.</a>
            <p><form>
                <label>Compose one titled:</label><br>
                <input id="anothertitle" type="text" size="20">
                <input id="composetitled" type="submit" value="Go">
              </form>
              <p><a id="permalink" href="">Permalink</a> to this verse.
          </tr>
          <tr class="sidebar"><td>
            <a href="http://github.com/darius/amphigory">How it works.</a>
            
            <p>Read the tale of
              <a href="http://books.google.com/books?id=kWElP9YZkzQC&pg=PA43&lpg=PA43&dq=trurl%27s+electronic+bard">Trurl's
                Electronic Bard.</a>
          </tr>
          <tr class="sidebar"><td>
            Copyright &#169; 2012
              <a href="http://wry.me/blog/">Darius Bacon</a>
          </tr>
        </table>
        </div>
      </td>
    </tr>
  </table>
  <script src="seedrandom.js"></script>
  <script src="pronounce_iamb_compat.js"></script>
  <script src="verse.js"></script>
</body></html>
